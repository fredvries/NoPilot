@echo off
setlocal EnableDelayedExpansion

echo.
echo NoPilot 1.1 - 2026 Edition
echo Microsoft Copilot heavy disable/hide script (February 2026)
echo ---------------------------------------------------------------
echo Hides most visible Copilot parts and applies official disable policy.
echo Complete removal impossible on 24H2/25H2; expect re-enablement after updates.
echo.

net session >nul 2>&1
if %errorlevel% neq 0 (
    echo This script must be run as Administrator.
    echo Right-click --^> Run as administrator
    pause
    exit /b 1
)

<nul set /p "=[1/11] Hiding taskbar button: "
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowCopilotButton /t REG_DWORD /d 0 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[2/11] Official disable policy: "
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot" /v TurnOffWindowsCopilot /t REG_DWORD /d 1 /f >nul 2>&1
reg add "HKCU\Software\Policies\Microsoft\Windows\WindowsCopilot" /v TurnOffWindowsCopilot /t REG_DWORD /d 1 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[3/11] Disable search web/AI suggestions: "
reg add "HKCU\Software\Policies\Microsoft\Windows\Explorer" /v DisableSearchBoxSuggestions /t REG_DWORD /d 1 /f >nul 2>&1
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v DisableSearchBoxSuggestions /t REG_DWORD /d 1 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[4/11] Force-kill Copilot/Edge WebView processes: "
powershell -NoProfile -ExecutionPolicy Bypass -Command "Stop-Process -Name 'msedge' -Force -ErrorAction SilentlyContinue; Stop-Process -Name 'msedgewebview2' -Force -ErrorAction SilentlyContinue; Stop-Process -Name 'Copilot' -Force -ErrorAction SilentlyContinue" >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed or none running)

<nul set /p "=[5/11] Uninstall Copilot app package: "
powershell -NoProfile -ExecutionPolicy Bypass -Command ^
    "Get-AppxPackage *Copilot* -AllUsers | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue;" ^
    "Get-AppxProvisionedPackage -Online | Where-Object {$_.DisplayName -like '*Copilot*'} | Remove-AppxProvisionedPackage -Online -ErrorAction SilentlyContinue" >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed or already gone)

<nul set /p "=[6/11] Block outbound (partial): "
netsh advfirewall firewall add rule name="Block Copilot" dir=out action=block remoteip=20.236.156.0/25,20.236.157.0/25,52.114.132.0/22 enable=yes >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[7/11] Disable legacy Edge sidebar: "
reg add "HKLM\SOFTWARE\Policies\Microsoft\Edge" /v HubsSidebarEnabled /t REG_DWORD /d 0 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[8/11] Block ms-copilot URI: "
reg add "HKCR\ms-copilot" /ve /d "URL:ms-copilot" /f >nul 2>&1
reg add "HKCR\ms-copilot\shell\open\command" /ve /d "\"C:\Windows\System32\cmd.exe\" /c exit" /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[9/11] Disable Copilot in Edge: "
reg add "HKLM\SOFTWARE\Policies\Microsoft\Edge" /v HubsSidebarEnabled /t REG_DWORD /d 0 /f >nul 2>&1
reg add "HKLM\SOFTWARE\Policies\Microsoft\Edge" /v AIPersonasEnabled /t REG_DWORD /d 0 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[10/11] Hide web/AI suggestions in Start search: "
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Search" /v BingSearchEnabled /t REG_DWORD /d 0 /f >nul 2>&1
if %errorlevel%==0 (echo Done) else (echo Failed)

<nul set /p "=[11/11] Cleanup complete: "
echo Done - restart PC now for best results.

echo.
echo Done - Most Copilot surface should now be hidden/disabled.
echo.
echo Remaining notes (2026 reality):
echo - Taskbar button + Win+C often fully gone after logoff/restart.
echo - Small stub/service + web fallback (copilot.microsoft.com) may persist.
echo - Edge sidebar/Copilot icon should now be suppressed via policy.
echo - Start menu web suggestions reduced (may still show some local AI).
echo - Re-run after: Windows Update, Edge update, feature upgrades, Insider builds, or new user creation.
echo.
pause
